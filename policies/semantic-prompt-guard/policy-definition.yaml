name: semantic-prompt-guard
version: v0.8.0
description: |
  Evaluates request prompts using embedding similarity against configured allow
  and deny phrases. Blocks prompts that match denied phrases or fail allow
  checks, with optional JSONPath extraction and configurable response detail.

parameters:
  type: object
  properties:
    jsonPath:
      type: string
      description: |
        Specifies the JSONPath used to extract prompt text from JSON payloads.
        When empty, the entire payload is evaluated as plain text.
      default: ""
    allowSimilarityThreshold:
      type: number
      description: |
        Specifies the minimum similarity score (0.0 to 1.0) required to match
        an allowed phrase.
      default: 0.65
      minimum: 0.0
      maximum: 1.0
    denySimilarityThreshold:
      type: number
      description: |
        Specifies the similarity score (0.0 to 1.0) at or above which a denied
        phrase blocks the request.
      default: 0.65
      minimum: 0.0
      maximum: 1.0
    allowedPhrases:
      type: array
      description: |
        Specifies phrases treated as allowed references for semantic comparison
        during request validation.
      default: []
      items:
        type: string
        description: Specifies a phrase to allow.
    deniedPhrases:
      type: array
      description: |
        Specifies phrases treated as denied references for semantic comparison
        during request validation.
      default: []
      items:
        type: string
        description: Specifies a phrase to deny.
    showAssessment:
      type: boolean
      description: |
        Specifies whether blocked responses include detailed assessment
        information.
      default: false

systemParameters:
  type: object
  properties:
    embeddingProvider:
      type: string
      description: |
        Embedding provider to use. Supported: AZURE_OPENAI, OPENAI, MISTRAL.
      enum:
        - AZURE_OPENAI
        - OPENAI
        - MISTRAL
      default: AZURE_OPENAI
      "wso2/defaultValue": "${config.embedding_provider}"
    embeddingEndpoint:
      type: string
      description: |
        HTTP endpoint for the embedding provider. For Azure OpenAI, this should be
        the base endpoint (e.g., https://myres.openai.azure.com).
        For OpenAI: "https://api.openai.com/v1/embeddings"
        For Mistral: "https://api.mistral.ai/v1/embeddings"
      minLength: 1
      "wso2/defaultValue": "${config.embedding_provider_endpoint}"
    embeddingModel:
      type: string
      description: |
        Embedding model name (required for OPENAI, MISTRAL; not required for AZURE_OPENAI)
        For OpenAI: "text-embedding-ada-002" or "text-embedding-3-small"
        For Mistral: "mistral-embed"
        For Azure OpenAI: Not required (deployment name is in the endpoint URL)
      "wso2/defaultValue": "${config.embedding_provider_model}"
    apiKey:
      type: string
      description: API key for the embedding provider.
      minLength: 1
      "wso2/defaultValue": "${config.embedding_provider_api_key}"
  required:
    - embeddingProvider
    - embeddingEndpoint
    - apiKey
